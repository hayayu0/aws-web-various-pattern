# ELB sorryサーバー 最小手順

## セキュリティグループの作成

- AWSマネージメントコンソールを開く
- VPCにアクセス
- セキュリティグループの作成
  - セキュリティグループ名: http80
  - セキュリティグループの説明: http80
  - インバウンドルール
    - 種類: カスタムTCP
    - ポート範囲: 80
    - ソース: 0.0.0.0/0
  - アウトバウンドルール
    - 無し（デフォルト設定を削除）

→　セキュリティグループが作成される

## ターゲットグループの作成

- AWSマネージメントコンソールを開く
- 東京リージョンを選択
- EC2 ＞ ターゲットグループにアクセス
  - ターゲットのタイプ: IP アドレス
  - ターゲットグループ名: TG1
  - プロトコル ポート: HTTP 80
  - IP アドレスタイプ: IPv4
  - VPC: デフォルトのVPC
  - プロトコルのバージョン: HTTP1
  - 次へボタン
  - IPv4アドレス: "172.31.0." のようにあらかじめ入力されているので末尾に「254」を追加
  - 保留中として以下を含めるボタンを押す
  - ターゲットグループの作成ボタンを押す

→ターゲットグループが作成される

## ELBの作成

- AWSマネージメントコンソールを開く
- 東京リージョンを選択
- EC2 ＞ ロードバランサーにアクセス
- ロードバランサーの作成ボタン
- ALBの作成ボタン
  - ロードバランサー名: elb1
  - スキーム: インターネット向け
  - IP アドレスタイプ: IPv4
  - VPC: デフォルトVPC
  - マッピング: ap-northeast-1a、ap-northeast-1c、ap-northeast-1d
  - セキュリティグループ: http80
  - リスナー
    - プロトコル ポート: HTTP 80
    - ターゲットグループ: TG1
- ロードバランサーの作成ボタンを押す

→　Application Load Balancer(ALB)が作成される

## 固定HTMLデータのルールの追加

- ロードバランサーの一覧から、elb の左のチェックボックスを入れる
- リスナーとルールタブをクリック
- ルール列の 1個のルール の文字をクリック
- ルールを追加するボタンを押す
- 名前とタグは何も入力せずに次へ
- 条件の追加ボタンを押す
  - 「送信元IP」
  - 「0.0.0.0/0」
- 確認ボタンと次へボタン
  - 固定レスポンスを返す
  - レスポンスコード: 503
  - Content-Type: text/html
  - レスポンス本文: elb-sorry-html.txt の内容を記載
- 次へボタン
- ルール優先度: 1
- 次へボタン
- 作成ボタン
  
→　固定HTMLデータのルールが追加される

elb1 の画面で払い出されたDNS名を確認

WebブラウザーからDNS名でアクセスするとsorryページが表示される

## 後片づけ

- ELB elb1 の削除
- ターゲットグループ TG1 の削除
- セキュリティグループ http80 の削除
